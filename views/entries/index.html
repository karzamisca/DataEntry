<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Entry</title>
    <style>
      /* Base styles for all screen sizes */
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        padding: 0;
        box-sizing: border-box;
        max-width: 100vw;
        overflow-x: hidden;
      }

      h1,
      h2 {
        color: #333;
      }

      table {
        width: 100%; /* Responsive width */
        border-collapse: collapse;
        margin-bottom: 20px;
        font-size: 1rem; /* Responsive font size */
      }

      table,
      th,
      td {
        border: 1px solid black;
      }

      th,
      td {
        padding: 8px;
        text-align: left;
      }

      form {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        width: 100%;
      }

      .form-group {
        margin-bottom: 10px;
        width: 15%; /* Use relative width */
      }

      form input,
      form button {
        padding: 5px;
        margin-left: 5px;
        width: 100%; /* Full width for inputs */
      }

      /* Media queries for responsiveness */

      /* Small devices (mobile) */
      @media only screen and (max-width: 600px) {
        h1,
        h2 {
          font-size: 1.2rem;
        }

        table {
          font-size: 0.8rem; /* Smaller font size for small screens */
        }

        .form-group {
          width: 48%; /* Stack the inputs side by side on smaller screens */
        }

        form input,
        form button {
          padding: 10px;
          margin-left: 0;
        }
      }

      /* Medium devices (tablets) */
      @media only screen and (min-width: 600px) and (max-width: 1024px) {
        h1,
        h2 {
          font-size: 1.5rem;
        }

        table {
          font-size: 0.9rem;
        }

        .form-group {
          width: 30%;
        }

        form input,
        form button {
          padding: 8px;
        }
      }

      /* Large devices (desktops) */
      @media only screen and (min-width: 1024px) {
        h1,
        h2 {
          font-size: 2rem;
        }

        table {
          font-size: 1rem;
        }

        .form-group {
          width: 15%;
        }

        form input,
        form button {
          padding: 5px;
        }
      }
    </style>
  </head>
  <body>
    <h1>Entries Table</h1>

    <!-- Export Button -->
    <button id="exportButton">Export to Excel</button>

    <!-- Table for displaying entries -->
    <table id="entriesTable">
      <thead>
        <tr>
          <th>Description</th>
          <th>Unit</th>
          <th>Amount</th>
          <th>Unit Price</th>
          <th>Total Price</th>
          <th>VAT</th>
          <th>Delivery Date</th>
          <th>Entry Date</th>
          <th>Actions</th>
          <!-- Added Actions Column -->
        </tr>
      </thead>
      <tbody>
        <!-- Rows will be inserted dynamically by JavaScript -->
      </tbody>
    </table>

    <h2>New Entry</h2>

    <!-- Horizontal form for adding a new entry -->
    <form id="entryForm" action="/entryNew" method="POST">
      <div class="form-group">
        <label for="description">Description:</label>
        <input type="text" id="description" name="description" required />
      </div>

      <div class="form-group">
        <label for="unit">Unit:</label>
        <input type="text" id="unit" name="unit" required />
      </div>

      <div class="form-group">
        <label for="amount">Amount:</label>
        <input type="number" id="amount" name="amount" required />
      </div>

      <div class="form-group">
        <label for="unitPrice">Unit Price:</label>
        <input
          type="number"
          step="0.01"
          id="unitPrice"
          name="unitPrice"
          required
        />
      </div>

      <div class="form-group">
        <label for="vat">VAT (%):</label>
        <input type="number" step="0.01" id="vat" name="vat" required />
      </div>

      <div class="form-group">
        <label for="deliveryDate">Delivery Date:</label>
        <input type="date" id="deliveryDate" name="deliveryDate" required />
      </div>

      <button type="submit">Submit</button>
    </form>

      <h2>Import Entries from Excel</h2>

      <!-- Form for importing Excel files -->
      <form
        id="importForm"
        action="/entryImport"
        method="POST"
        enctype="multipart/form-data"
      >
        <input type="file" name="excelFile" accept=".xlsx, .xls" required />
        <button type="submit">Import from Excel</button>
      </form>
    </form>
    <a href="/main">Back to Main</a><br />
    <a href="/logout">Logout</a><br />

    <script>
window.onload = async function() {
  const tableBody = document.querySelector('#entriesTable tbody');
  const exportButton = document.getElementById('exportButton');

  // Fetch entries from the backend
  const response = await fetch('/entryAll');
  const entries = await response.json();

  // Dynamically add each entry as a row in the table
  entries.forEach(entry => {
    const row = document.createElement('tr');

    row.innerHTML = `
      <td>${entry.description}</td>
      <td>${entry.unit}</td>
      <td>${entry.amount}</td>
      <td>${entry.unitPrice}</td>
      <td>${entry.totalPrice}</td>
      <td>${entry.vat}</td>
      <td>${new Date(entry.deliveryDate).toDateString()}</td> <!-- Format delivery date -->
      <td>${entry.entryDate}</td> <!-- Entry date will be formatted in the backend -->
      <td><button class="delete-button" data-id="${entry._id}">Delete</button></td> <!-- Delete Button -->
    `;

    tableBody.appendChild(row);
  });

  // Add event listeners for delete buttons
  document.querySelectorAll('.delete-button').forEach(button => {
    button.addEventListener('click', async (event) => {
      const entryId = event.target.getAttribute('data-id');
      if (confirm('Are you sure you want to delete this entry?')) {
        const deleteResponse = await fetch(`/entryDelete/${entryId}`, {
          method: 'DELETE'
        });

        if (deleteResponse.ok) {
          // Remove the row from the table
          event.target.closest('tr').remove();
          alert('Entry deleted successfully!');
        } else {
          const errorData = await deleteResponse.json();
          alert('Error deleting entry: ' + errorData.error);
        }
      }
    });
  });

  // Handle Export Button Click
  exportButton.addEventListener('click', () => {
    window.location.href = '/entryExport';
  });
};

    </script>
  </body>
</html>
